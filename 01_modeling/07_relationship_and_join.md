# 1-7. 관계와 조인의 이해

## 1. 관계(Relationship)의 개념
- 관계란 **엔터티의 인스턴스 간 논리적 연관성**을 의미한다.  
- 데이터 모델링에서 관계를 정의한다는 것은, 부모 엔터티의 식별자를 자식 엔터티에 상속시키고 이를 **매핑키(조인키)**로 활용하여 두 엔터티를 연결하는 과정이다.  
- 관계는 **엔터티의 정의, 속성 정의 및 비즈니스 규칙**에 따라 달라질 수 있다.

---

## 2. 관계의 분류
관계는 크게 두 가지로 분류된다.

- **존재적 관계(Existence Relationship)**  
  - 한 엔터티의 존재가 다른 엔터티의 존재에 영향을 미침  
  - 예시: 사원은 반드시 부서에 소속되어야 한다 → 사원 엔터티는 부서 엔터티에 종속

- **행위적 관계(Behavioral Relationship)**  
  - 한 엔터티의 행위나 이벤트에 의해 다른 엔터티가 발생  
  - 예시: 고객의 행위(주문)에 의해 주문 엔터티가 생성됨

※ ERD에서는 존재적/행위적 관계를 구분하지 않고 단순히 "관계"로 표현한다.

---

## 3. 조인(Join)의 의미
- **정규화**를 통해 데이터 중복을 최소화하면, 하나의 엔터티가 여러 개의 엔터티로 분리된다.  
- 분리된 엔터티들은 서로 **관계(Relationship)**를 맺게 되고, 실제 조회 시 두 테이블을 **연결(Join)**해야 한다.  
- 따라서 **조인(Join)**은 "관계가 정의된 두 테이블을 연결하여 원하는 데이터를 동시에 조회하는 과정"이라고 정의할 수 있다.  
- 조인 시 사용되는 연결 키를 **조인키(Join Key)**라고 한다.

### 예시
- 계좌 테이블과 관리점 테이블이 분리된 경우  
  - `계좌.관리점코드 = 관리점.관리점코드`를 이용하여 두 테이블을 연결해야 함  

```sql
-- 구식 조인 방식
SELECT A.계좌번호, B.관리점명
FROM 계좌 A, 관리점 B
WHERE A.관리점코드 = B.관리점코드
  AND A.계좌번호 = '100111';

-- 현대적(ANSI) 조인 방식
SELECT A.계좌번호, B.관리점명
FROM 계좌 A
JOIN 관리점 B
  ON A.관리점코드 = B.관리점코드
WHERE A.계좌번호 = '100111';
```

---

## 4. 조인의 종류

* **INNER JOIN (내부 조인)**

    * 두 테이블 모두에 존재하는 데이터만 반환
    * 예: 고객과 주문을 INNER JOIN하면, 주문한 고객만 조회됨

* **OUTER JOIN (외부 조인)**

    * 한쪽 테이블에만 있는 데이터도 포함
    * LEFT OUTER JOIN: 왼쪽 테이블은 모두 표시, 오른쪽 매칭이 없으면 NULL
    * RIGHT OUTER JOIN: 오른쪽 테이블은 모두 표시
    * FULL OUTER JOIN: 양쪽 모두 표시 (일부 DBMS만 지원)

* **SELF JOIN (자기 조인)**

    * 하나의 테이블을 자기 자신과 조인하는 방식
    * **계층 구조** 표현에 자주 사용됨 (예: 직원 테이블에서 상사-부하 관계)

```sql
SELECT E1.ENAME AS 사원명, E2.ENAME AS 매니저명
FROM EMP E1
JOIN EMP E2
  ON E1.MGR = E2.EMPNO;
```

* **CROSS JOIN (카테시안 곱)**

    * 조인 조건 없이 모든 경우의 수를 반환
    * 대부분 실제 업무에는 사용하지 않으며, 잘못된 조인 조건에서 발생

---

## 5. 특수한 관계

* **계층형 관계**

    * 같은 엔터티 내에서 계층 구조를 갖는 경우 (예: 직원-매니저)
    * 표현 방식: SELF JOIN

* **상호배타적 관계(Mutually Exclusive Relationship)**

    * 두 개 이상의 관계 중 하나만 선택 가능
    * 예: 주문은 개인고객 또는 법인고객 중 하나에만 연결됨

---

## 6. 시험 포인트

* 관계 정의와 조인은 **정규화로 분리된 테이블을 연결하기 위해 필요**하다는 점 강조
* INNER JOIN vs OUTER JOIN 차이, SELF JOIN의 쓰임새를 구분할 수 있어야 함
* **SQL 구식 조인(WHERE 절)과 ANSI JOIN(ON 절) 모두 알아야 함**
* SELF JOIN → 계층형 구조 (대표 예: 사원-매니저 관계)
* N\:M 관계는 **조인 시 카테시안 곱이 발생 → 반드시 연결 엔터티로 해소**
