# 1-6. 정규화 (Normalization)

## 1. 정규화 개념
정규화는 데이터베이스 설계 과정에서 **중복 데이터를 최소화**하고 **데이터의 일관성(consistency)**을 확보하기 위해 엔터티(또는 테이블)를 분해하는 과정이다.
- 저장 공간의 효율성 확보
- 데이터 무결성 보장
- 이상 현상(Anomaly) 방지
- 데이터 모델의 독립성과 유연성 강화

### 정규화의 필요성
- 하나의 엔터티에 너무 많은 속성을 넣으면 불필요한 데이터 중복이 발생하고, 조회 시 불필요한 데이터까지 함께 조회됨
- 데이터를 원자 단위로 분리해야 관리와 유지보수가 용이
- 중복 제거 → 무결성 확보, 삽입/수정/삭제 연산 안정성 향상

---

## 2. 이상현상 (Anomaly)
정규화를 수행하지 않으면 다음과 같은 이상현상이 발생한다.

### ① 삽입 이상 (Insertion Anomaly)
- 새로운 데이터를 삽입할 때 불필요한 값까지 입력해야 하는 상황
- 예: 사원+부서를 합친 테이블에서, 새로운 사원을 추가하려면 부서정보(부서명, 위치 등)까지 임의로 입력해야 함

### ② 갱신 이상 (Update Anomaly)
- 같은 데이터가 여러 곳에 중복 저장되어 있을 때, 한 곳만 수정하면 불일치 발생
- 예: 부서 위치를 변경할 경우, 여러 행의 값을 모두 수정해야 하며 일부만 수정되면 데이터 불일치 발생

### ③ 삭제 이상 (Deletion Anomaly)
- 특정 데이터를 삭제할 때 원하지 않는 다른 데이터까지 함께 삭제되는 상황
- 예: 부서 정보만 삭제하려고 했는데, 그 부서에 속한 사원 정보까지 함께 삭제되는 경우

---

## 3. 정규화의 목표
- **중복 데이터 제거**
- **데이터 무결성 유지**
- **데이터 이상현상 방지**
- **데이터 구조 단순화 및 효율적 관리**

---

## 4. 정규화 단계

### ① 제 1 정규화 (1NF)
- 속성이 **원자값(atomic value)**만 가지도록 테이블을 분해
- 한 컬럼에 여러 값이 들어가면 안 되고, 반드시 하나의 값만 저장되어야 함

**예시 (구매 테이블):**
| 고객명 | 구매상품       | 가격           |
|--------|----------------|----------------|
| 홍길동 | 상품1, 상품2   | 1000, 2000     |

→ **1NF 적용 후**
| 고객명 | 구매상품 | 가격 |
|--------|----------|------|
| 홍길동 | 상품1    | 1000 |
| 홍길동 | 상품2    | 2000 |

---

### ② 제 2 정규화 (2NF)
- **부분 함수 종속 제거**
- 기본키가 2개 이상(복합키)일 경우, 기본키의 일부에만 종속되는 속성이 존재하면 분리해야 함

**예시 (수강이력 테이블):**
- 기본키: (학생번호, 강의명)
- 강의실이 **강의명**에 의해 결정됨 → 부분 함수 종속 발생

→ 강의실 정보를 별도 테이블로 분리
- 수강이력(학생번호, 강의명)
- 강의(강의명, 강의실)

---

### ③ 제 3 정규화 (3NF)
- **이행적 종속 제거**
- A → B, B → C 이면 A → C가 성립되는데, 이 경우를 분리해야 함

**예시 (구매 테이블):**
- 고객번호 → 상품명
- 상품명 → 가격
- 따라서 고객번호 → 가격 (이행적 종속) 발생

→ 상품을 별도 테이블로 분리
- 구매(고객번호, 상품명)
- 상품(상품명, 가격)

---

### 정리
- **1NF**: 원자값 분해 (중복 데이터 행 분리)
- **2NF**: 부분 함수 종속 제거 (복합키일 때 문제 해결)
- **3NF**: 이행적 종속 제거 (중간 매개 속성 분리)

---

## 5. 고급 정규화 & 반정규화

### ① BCNF (Boyce-Codd Normal Form)
- 모든 **결정자(Determinant)**가 **후보키(Candidate Key)**가 되도록 분해
- 즉, 결정자가 후보키가 아닌 경우가 없어야 함

---

### ② 제 4 정규화 (4NF)
- **다중값 종속(Multi-valued Dependency)** 제거
- 하나의 속성이 여러 속성 집합을 독립적으로 종속시키는 경우 분리 필요

예: 한 학생이 여러 전공과 여러 동아리에 동시에 소속 가능할 때, 전공과 동아리를 별도 테이블로 분리

---

### ③ 제 5 정규화 (5NF)
- **조인 종속(Join Dependency)** 제거
- 테이블을 여러 개로 분리했을 때, 다시 조인해야만 원래 데이터를 얻을 수 있는 경우 문제 발생
- 가능한 불필요한 조인 종속성 제거

---

### ④ 반정규화 (De-Normalization)
- 성능 향상을 위해 의도적으로 **정규화를 일부 해제**하는 과정
- 데이터 중복 허용 → 조회 성능 ↑ / 갱신·삭제 이상 발생 가능성 ↑

**반정규화 적용 사례**
- 대량 데이터 조회 시 성능 향상이 필요한 경우
- 자주 사용하는 **집계/요약 정보**를 미리 저장
- 조인으로 인한 성능 저하를 줄이기 위해 컬럼 중복 허용

---

### 정리
- **BCNF**: 결정자가 후보키만 되도록 설계
- **4NF**: 다중값 종속 제거
- **5NF**: 조인 종속 제거
- **반정규화**: 성능 최적화를 위해 정규화 일부 해제
